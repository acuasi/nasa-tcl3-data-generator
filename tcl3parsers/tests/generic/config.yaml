---
# Specify which parsers you want to run. If this is empty, then all parsers will run
run:
    - CON5

# Specify all new parsers below.

# required_files:
# The order they are specified below is the order they will be added as parameters when
# the parser is run.
# Following each specified file is the regex or part of the name that will be searched for.
#
# The output file name is automatically added as the last
# parameter with the format {parser_name}_data_flight_{number}.json
#
# Parser Naming:
# The entry function called from the outside world for every parser must be named the same as it's file name.
#
# file_parsers:
# The key of file parsers must correspond with a required_file shortname and the value must be
# the name of the file parser without .py. File parsers are
# File Parsers are passed the model and the filename (in that order) and are expected to return the model.
#
# variable_parsers:
# The key of the variable parser must correspond to a master variable. If the master variable it corresponds to is nested,
# then use brackets, without inner quotes and with quotes surrounding the entire key optional. Ex. topLevel[subLevel] or 'topLevel[subLevel]'
# Variable Parsers are passed a dictionary containing all of the filenames, with the file's shortname as the key
#
# global_parsers:
# The use of these parsers is discouraged. These parsers are passed the model and a dictionary containing all of the filenames
# and are expected to return the model. These parsers are the most risky/inefficient to use as they are passed all of the data
# and control what the entire model is set to.
#

parsers:
    cns1:
        swagger_hub_spec: https://app.swaggerhub.com/apis/utm/tcl3-cns/v2
        sub_parsers: flight_data
        required_files:
            MI_FILE:
                - mission_insight.csv
            DF_FILE:
                - .log
            FIELD_VARS:
                - field_vars.csv
        file_parsers:
            MI_FILE:
                parser: mission_insight
            DF_FILE:
                parser: ardu_data_flash_str
            FIELD_VARS:
                parser: field_vars_cns1
        variable_parsers:
            fType:
                exact: CNS1
            UTM-TCL3-DMP-RevF-CNSPDF:
                exact: UTM-ACUASI-CNS-1.pdf
            plannedContingency[plannedContingencyLoiterAlt_ft]:
                exact: '[0]'
            plannedContingency[plannedContingencyLoiterRadius_ft]:
                exact: '[0]'

    cns2:
        swagger_hub_spec: https://app.swaggerhub.com/apis/utm/tcl3-cns/v2
        sub_parsers: flight_data
        required_files:
            MI_FILE:
                - mission_insight.csv
                - ^CNS2_.+Flight.+\.csv
            DF_FILE:
                - .log
            RADAR_FILE:
                - Radar Flight
        file_parsers:
            MI_FILE:
                parser: mission_insight
            DF_FILE:
                parser: ardu_data_flash_str
        variable_parsers:
            fType:
                exact: CNS2
            UTM-TCL3-DMP-RevF-CNSPDF:
                exact: UTM-ACUASI-CNS-2.pdf
            plannedContingency[plannedContingencyLoiterAlt_ft]:
                exact: '[0]'
            plannedContingency[plannedContingencyLoiterRadius_ft]:
                exact: '[0]'
            uasTruth:
                parser: uasTruth
            uasTruth[estimatedTruthPositionError95Prct_in]:
                exception: None

    con1:
        swagger_hub_spec: https://app.swaggerhub.com/apis/utm/tcl3-con/v2
        sub_parsers: flight_data
        required_files:
            MI_FILE:
                - mission_insight.csv
            DF_FILE:
                - .log
            FIELD_VARS:
                - field_vars.csv
            WEATHER_FILE:
                - _weather_file.csv
        file_parsers:
            MI_FILE:
                parser: mission_insight
            FIELD_VARS:
                parser: generic_field_vars
            DF_FILE:
                parser: con1_data_flash
            WEATHER_FILE:
                parser: weather_file
        variable_parsers:
            fType:
                exact: CON1
            UTM-TCL3-DMP-RevF-CONPDF:
                exact: UTM-ACUASI-CON-1.pdf
            c2PacketLoss[c2PacketLossRateAircraftPrct_nonDim]:
                exception: None
            c2PacketLoss[c2PacketLossRateGcsPrct_nonDim]:
                exception: None

    CON2,4_ardu:
        sub_parsers:
            - con4
            - con2_ardu:
                for: [
                    2018-05-25/N253MH/Flight 2,
                    2018-05-25/N253MH/Flight 4,
                    2018-05-25/N260MH/Flight 2,
                    2018-05-25/N260MH/Flight 5
                ]
            - flight_data
    CON2,4_dji:
        sub_parsers:
            - con4
            - con2_dji:
                for: [
                    2018-05-25/N252MH/Flight 2,
                    2018-05-25/N252MH/Flight 5
                ]
            - dji_flight_data

    CON2,4_ptar:
        sub_parsers:
            - con4
            - con2_ptar:
                for: [
                    2018-05-25/N241UA/Flight 2,
                    2018-05-25/N241UA/Flight 5
                ]
            - ptar_flight_data

    CON5:
        sub_parsers:
            - flight_data

    SAA2:
        swagger_hub_spec: https://app.swaggerhub.com/apis/utm/tcl3-saa/v2
        name_override: SAA2
        sub_parsers:
            - flight_data
        required_files:
            MI_FILE:
                - mission_insight.csv
            TI_FILE:
                - TI.csv
            TD_FILE:
                - TD.csv
            FIELD_VARS:
                - field_vars.csv
            DF_FILE:
                - .log
        file_parsers:
            MI_FILE:
                parser: mission_insight
            FIELD_VARS:
                parser: saa_field_vars
        global_parsers:
                - geoFence
        variable_parsers:
            fType:
                exact: SAA2
            UTM-TCL3-DMP-RevF-CONPDF:
                exact: UTM-ACUASI-SAA-2.pdf
            geoFence[geoFenceDynamicPolygonPoint]:
                exception: None

    SAA4:
        swagger_hub_spec: https://app.swaggerhub.com/apis/utm/tcl3-saa/v2
        name_override: SAA4
        sub_parsers:
            - flight_data
        required_files:
            MI_FILE:
                - mission_insight.csv
            TI_FILE:
                - TI.csv
            TD_FILE:
                - TD.csv
            FIELD_VARS:
                - field_vars.csv
            RADAR_FILE:
                - radar_data.csv
        global_parsers:
            - saa4_main
        file_parsers:
            MI_FILE:
                parser: mission_insight
            FIELD_VARS:
                parser: saa_field_vars
        variable_parsers:
            fType:
                exact: SAA4
            UTM-TCL3-DMP-RevF-CONPDF:
                exact: UTM-ACUASI-SAA-4.pdf
            intruder[intruderVelDown_ftPerSec]:
                exception: None
            intruder[intruderGroundCourse_deg]:
                exception: None
            intruder[relativeHeadingAtFirstDetection_deg]:
                exception: None
            intruder[horRangeAccuracy_ft]:
                exception: None
            intruder[verRangeAccuracy_ft]:
                exception: None
            intruder[probabilityFalseAlarmPrct_nonDim]:
                exception: None
            intruder[probabilityIntruderDetectionPrct_nonDim]:
                exception: None
            intruder[dataPacketRatio_nonDim]:
                exception: None
            intruder[transmissionDelay_sec]:
                exception: None
            intruder[numberOfLostTracks_nonDim]:
                exception: None
            intruder[saaSensorAltitudeAccuracy_ft]:
                exception: None

# These parsers are the same as regular parsers, except they get their files from a parent parser, operate concurrently, and output to the parent's folder
sub_parsers:
    # Note: flight_data is an expensive subparser to run, taking up to 30 seconds per flight. For testing, commenting out the sub_parser in the parent parser
    # will greatly speed things up.
    flight_data:
        swagger_hub_spec: https://app.swaggerhub.com/apis/utm/tcl3-flight-data/v3
        # skip_if_files_not_found: true
        required_files:
            MI_FILE:
                - mission_insight.csv
                - ^[A-Z]{3,3}[1-9]_.+Flight.+\.csv
                - ^[A-Z]{3,3}[1-9].+\.csv
            DF_FILE:
                - .log
        global_parsers:
            - flight_data_ardu
        file_parsers:
            MI_FILE:
                parser: mission_insight
        variable_parsers:
            fType:
                exact: FLIGHT_DATA
            auxiliaryUASOperation:
                parser: auxiliaryUASOperation
            aircraftFlightPlan[wpTargetGroundSpeed_ftPerSec]:
                exception: None
            aircraftFlightPlan[wpTargetAirSpeed_ftPerSec]:
                exception: None
            uasState[value]:
                exception: None
            aircraftFlightPlan[wpType_nonDim]:
                exception: None
            auxiliaryUASOperation[takeOffTime]:
                exception: None
            auxiliaryUASOperation[takeoffPosLat_deg]:
                exception: None
            auxiliaryUASOperation[takeoffPosLon_deg]:
                exception: None
            auxiliaryUASOperation[takeoffPosAlt_ft]:
                exception: None
            auxiliaryUASOperation[landingTime]:
                exception: None
            auxiliaryUASOperation[landingPosLat_deg]:
                exception: None
            auxiliaryUASOperation[landingPosLon_deg]:
                exception: None
            auxiliaryUASOperation[landingPosAlt_ft]:
                exception: None

    dji_flight_data:
        swagger_hub_spec: https://app.swaggerhub.com/apis/utm/tcl3-flight-data/v3
        name_override: FLIGHT_DATA
        skip_if_files_not_found: true
        required_files:
            MI_FILE:
                - mission_insight.csv
                - ^[A-Z]{3,3}[1-9]_.+Flight.+\.csv
                - ^[A-Z]{3,3}[1-9]_.+\.csv
            WAYPOINTS:
                - waypoints.csv
            LITCHI:
                - _v2.csv
        global_parsers:
            - flight_data_dji
        file_parsers:
            MI_FILE:
                parser: mission_insight
        variable_parsers:
            fType:
                exact: FLIGHT_DATA
            auxiliaryUASOperation:
                parser: auxiliaryUASOperation
            aircraftFlightPlan[wpTargetGroundSpeed_ftPerSec]:
                exception: None
            aircraftFlightPlan[wpTargetAirSpeed_ftPerSec]:
                exception: None
            uasState[value]:
                exception: None
            aircraftFlightPlan[wpType_nonDim]:
                exception: None
            aircraftFlightPlan[wpTime]:
                exception: None

    ptar_flight_data:
        swagger_hub_spec: https://app.swaggerhub.com/apis/utm/tcl3-flight-data/v3
        name_override: FLIGHT_DATA
        skip_if_files_not_found: true
        required_files:
            MI_FILE:
                - mission_insight.csv
                - ^[A-Z]{3,3}[1-9]_.+Flight.+\.csv
                - ^[A-Z]{3,3}[1-9]_.+\.csv
            WAYPOINTS:
                - .waypoints
            TLOG:
                - _tlog.csv
        global_parsers:
            - flightDataPtar
        file_parsers:
            MI_FILE:
                parser: mission_insight
        variable_parsers:
            fType:
                exact: FLIGHT_DATA
            auxiliaryUASOperation:
                parser: auxiliaryUASOperation
            aircraftFlightPlan[wpTargetGroundSpeed_ftPerSec]:
                exception: None
            aircraftFlightPlan[wpTargetAirSpeed_ftPerSec]:
                exception: None
            uasState[value]:
                exception: None
            aircraftFlightPlan[wpType_nonDim]:
                exception: None
            aircraftFlightPlan[wpTime]:
                exception: None

    con2_ardu:
        name_override: CON2_MOP
        swagger_hub_spec: https://app.swaggerhub.com/apis/utm/tcl3-con/v2
        required_files:
            MI_FILE:
                - mission_insight.csv
            DF_FILE:
                - .log
            FIELD_VARS:
                - field_vars.csv
        file_parsers:
            MI_FILE:
                parser: mission_insight
            DF_FILE:
                parser: ardu_data_flash
            FIELD_VARS:
                parser: generic_field_vars
        variable_parsers:
            fType:
                exact: CON2
            UTM-TCL3-DMP-RevF-CONPDF:
                exact: UTM-ACUASI-CON-2.pdf
            UTM-TCL3-DMP-RevF-CONKML:
                exact: UTM-ACUASI-CON-2.kml
            plannedContingency[plannedContingencyLoiterAlt_ft]:
                exact: [0]
            plannedContingency[plannedContingencyLoiterRadius_ft]:
                exact: [0]
            declaredEmerg[ts]:
                exception: None
            contingencyCause[ts]:
                exception: None
            contingencyResponse[ts]:
                exception: None
            contingencyLoiterType[ts]:
                exception: None
            contingencyLoiterAlt[ts]:
                exception: None
            contingencyLoiterRadius[ts]:
                exception: None

    con4:
        name_override: CON4_MOP
        swagger_hub_spec: https://app.swaggerhub.com/apis/utm/tcl3-con/v2
        required_files:
            MI_FILE:
                - mission_insight.csv
                - CON4.+\.csv
        file_parsers:
            MI_FILE:
                parser: mission_insight
        variable_parsers:
            fType:
                exact: CON4
            UTM-TCL3-DMP-RevF-CONPDF:
                exact: UTM-ACUASI-CON-4.pdf
            UTM-TCL3-DMP-RevF-CONKML:
                exact: UTM-ACUASI-CON-4.kml

    con2_dji:
        name_override: CON2_MOP
        swagger_hub_spec: https://app.swaggerhub.com/apis/utm/tcl3-con/v2
        required_files:
            MI_FILE:
                - mission_insight.csv
            LITCHI:
                - _v2.csv
        file_parsers:
            MI_FILE:
                parser: mission_insight
            LITCHI:
                parser: dji_litchi
        variable_parsers:
            fType:
                exact: CON2
            UTM-TCL3-DMP-RevF-CONPDF:
                exact: UTM-ACUASI-CON-2.pdf
            UTM-TCL3-DMP-RevF-CONKML:
                exact: UTM-ACUASI-CON-2.kml
            plannedContingency[plannedContingencyLoiterAlt_ft]:
                exact: [0]
            plannedContingency[plannedContingencyLoiterRadius_ft]:
                exact: [0]

    con2_ptar:
        name_override: CON2_MOP
        swagger_hub_spec: https://app.swaggerhub.com/apis/utm/tcl3-con/v2
        required_files:
            MI_FILE:
                - mission_insight.csv
            TLOG:
                - _tlog.csv
        file_parsers:
            MI_FILE:
                parser: mission_insight
            TLOG:
                parser: ptar_tlog
        variable_parsers:
            fType:
                exact: CON2
            UTM-TCL3-DMP-RevF-CONPDF:
                exact: UTM-ACUASI-CON-2.pdf
            UTM-TCL3-DMP-RevF-CONKML:
                exact: UTM-ACUASI-CON-2.kml
            plannedContingency[plannedContingencyLoiterAlt_ft]:
                exact: [0]
            plannedContingency[plannedContingencyLoiterRadius_ft]:
                exact: [0]

# This specifies the global output directory where all parsed JSON files will be placed.
# This can either be a relative or absolute path, if nothing is specified, then
# the JSON files will be placed in whatever directory the runner file is run from.
output_directory: "output"

# If this is set, then the a local copy of the specification from swaggerhub will be checked for first before it is scraped from swaggerhub
cache_specifications: true

# This is directory where specifications will be checked for before scraping.
specification_cache_directory: "specifications"

# This directory holds all of the flight format folders and their associated data
parent_data_directory: flight_files

# This directory is inside of a format folder and contains all of the flights
flight_data_directory: data

...
